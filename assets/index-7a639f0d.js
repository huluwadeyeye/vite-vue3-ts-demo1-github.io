import{J as V,d as P,c as S,r as u,G as B,K as U,e as m,o as x,s as E,w as o,g as q,h as e,i as l,L as A,k as N,M as R,_ as M,N as le,f as oe,A as te,C as $,n as O,F as ae}from"./index-5e8add3e.js";const ne=(a,c,g)=>V.get(`/admin/acl/role/${a}/${c}?roleName=${g}`),se=a=>V.delete("/admin/acl/role/remove/"+a),re=a=>V.post("/admin/acl/role/save",a),ie=a=>V.put("/admin/acl/role/update",a),ce=a=>V.get("/admin/acl/permission/toAssign/"+a),de=(a,c)=>V.post(`/admin/acl/permission/doAssign/?roleId=${a}&permissionId=${c}`),ue={class:"dialog-footer"},me=P({__name:"addRole",props:{showDlg:{type:Boolean,default:!1},id:Number,roleName:String},emits:"closeDlg",setup(a,{emit:c}){const g=a;let r=S({roleName:""});const i=u(),h=S({roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}]});B(()=>{r.roleName=g.roleName||""});const D=U(()=>g.id?"修改":"新增"),k=()=>{c("closeDlg",!1)},v=async p=>{p&&await p.validate(async(_,s)=>{if(_){const t=g.id?await re(r):await ie(r);console.log(t),t.code==200?R.success(r.id?"修改成功":"新增成功"):R.warning("新增失败"),c("saveDlg",!1)}else console.log("error submit!",s)})};return(p,_)=>{const s=m("el-input"),t=m("el-form-item"),f=m("el-form"),b=m("el-dialog");return x(),E(b,{modelValue:a.showDlg,title:l(D),width:"500px","before-close":k},{footer:o(()=>[q("div",ue,[e(l(A),{onClick:k},{default:o(()=>[N("取消")]),_:1}),e(l(A),{type:"primary",onClick:_[1]||(_[1]=z=>v(i.value))},{default:o(()=>[N("确定")]),_:1})])]),default:o(()=>[q("div",null,[e(f,{model:l(r),"label-width":"100px",ref_key:"formRef",ref:i,rules:h,inline:""},{default:o(()=>[e(t,{label:"角色名称",prop:"roleName"},{default:o(()=>[e(s,{clearable:"",modelValue:l(r).roleName,"onUpdate:modelValue":_[0]||(_[0]=z=>l(r).roleName=z),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"])}}});const pe=M(me,[["__scopeId","data-v-91779c58"]]),_e={class:"content"},fe={class:"dialog-footer"},ge=P({__name:"perRole",props:{showDlg:{type:Boolean,default:!1},id:Number,roleName:String},emits:"closeDlg",setup(a,{emit:c}){const g=a;u();let r=S({roleName:"",id:0}),i=u([]),h=u(),D=u([]);const k={children:"children",label:"name"};B(async()=>{r.roleName=g.roleName||"",r.id=g.id||0,Object.assign(r,r);let s=await ce(r.id);s.code==200&&(i.value=s.data,D.value=v(i.value,[]))});const v=(s,t)=>(s.forEach(f=>{f.select&&f.level==4&&t.push(f.id),f.children&&f.children.length>0&&v(f.children,t)}),t);U(()=>g.id?"修改":"新增");const p=()=>{c("closeDlg",!1)},_=async()=>{const s=r.id;let t=h.value.getCheckedKeys(),f=h.value.getHalfCheckedKeys(),b=t.concat(f);(await de(s,b)).code==200?R.success("分配权限成功"):R.warning("分配权限失败"),c("saveDlg",!1)};return(s,t)=>{const f=m("el-tree"),b=m("el-dialog");return x(),E(b,{modelValue:a.showDlg,title:"分配权限",width:"500px","before-close":p},{footer:o(()=>[q("div",fe,[e(l(A),{onClick:p},{default:o(()=>[N("取消")]),_:1}),e(l(A),{type:"primary",onClick:_},{default:o(()=>[N("确定")]),_:1})])]),default:o(()=>[q("div",_e,[e(f,{ref_key:"tree",ref:h,data:l(i),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":l(D),props:k},null,8,["data","default-checked-keys"])])]),_:1},8,["modelValue"])}}});const ve=M(ge,[["__scopeId","data-v-fce43d96"]]),he=P({__name:"index",setup(a){let c=S({roleName:""}),g=u(!1);const r=u();let i=u(1),h=u(5),D=u(0),k=u([]),v=u(!1),p=u(!1),_=u(),s=u("");B(()=>{t()});const t=()=>{g.value=!0,ne(i.value,h.value,c.roleName).then(n=>{console.log("res: ",n),n.code==200&&(console.log("res: ",n),k.value=n.data.records||[],D.value=n.data.total||0)}).finally(()=>{g.value=!1})},f=()=>{i.value=1,t()},b=()=>{i.value=1,t(),v.value=!1,p.value=!1},z=()=>{i.value=1,c.roleName="",t()},T=n=>{_.value=n.id,s.value=n.roleName,p.value=!0},K=()=>{v.value=!0,_.value="",s.value=""},j=(n,y)=>{v.value=!0,_.value=n,s.value=y},G=n=>{h.value=n,t()},H=n=>{console.log("page: ",n),i.value=n,t()},J=async n=>{(await se(n)).code==200?(R({type:"success",message:"删除成功"}),t()):R({type:"error",message:"删除失败"})};return(n,y)=>{const Q=m("el-input"),F=m("el-form-item"),C=m("el-button"),W=m("el-form"),I=m("el-card"),w=m("el-table-column"),X=m("el-popconfirm"),Y=m("el-table"),Z=m("el-pagination"),ee=le("loading");return x(),oe(ae,null,[e(I,null,{default:o(()=>[e(W,{model:l(c),"label-width":"100px",ref_key:"searchFormRef",ref:r,inline:""},{default:o(()=>[e(F,{label:"角色名称"},{default:o(()=>[e(Q,{clearable:"",placeholder:"角色名称",modelValue:l(c).roleName,"onUpdate:modelValue":y[0]||(y[0]=d=>l(c).roleName=d)},null,8,["modelValue"])]),_:1}),e(F,null,{default:o(()=>[e(C,{type:"primary",onClick:f},{default:o(()=>[N("搜索")]),_:1}),e(C,{onClick:z},{default:o(()=>[N("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(I,{style:{"margin-top":"14px"}},{default:o(()=>[e(C,{type:"primary",size:"default",icon:"Plus",onClick:K},{default:o(()=>[N(" 新增角色 ")]),_:1}),te((x(),E(Y,{style:{margin:"10px 0px"},border:"",data:l(k)},{default:o(()=>[e(w,{label:"序号",width:"80px",align:"center",type:"index"}),e(w,{label:"id",prop:"id",align:"center"}),e(w,{label:"角色名称",prop:"roleName",align:"center"}),e(w,{label:"创建时间",prop:"createTime",align:"center"}),e(w,{label:"更新时间",prop:"updateTime",align:"center"}),e(w,{width:"240",label:"操作",align:"center"},{default:o(({row:d})=>[e(C,{type:"primary",size:"small",icon:"Edit",onClick:L=>T(d)},{default:o(()=>[N(" 分配权限 ")]),_:2},1032,["onClick"]),e(C,{type:"primary",size:"small",icon:"Edit",onClick:L=>j(d.id,d.roleName)},{default:o(()=>[N(" 编辑 ")]),_:2},1032,["onClick"]),e(X,{title:`您确定要删除${d.tmName}?`,width:"250px",icon:"Delete",onConfirm:L=>J(d.id)},{reference:o(()=>[e(C,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[ee,l(g)]]),e(Z,{onSizeChange:G,onCurrentChange:H,"pager-count":9,"current-page":l(i),"onUpdate:currentPage":y[1]||(y[1]=d=>$(i)?i.value=d:i=d),"page-size":l(h),"onUpdate:pageSize":y[2]||(y[2]=d=>$(h)?h.value=d:h=d),"page-sizes":[5,10,15,20],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:l(D)},null,8,["current-page","page-size","total"]),l(v)?(x(),E(pe,{key:0,showDlg:l(v),onCloseDlg:y[3]||(y[3]=d=>$(v)?v.value=!1:v=!1),id:l(_),onSaveDlg:b,roleName:l(s)},null,8,["showDlg","id","roleName"])):O("",!0),l(p)?(x(),E(ve,{key:1,showDlg:l(p),onCloseDlg:y[4]||(y[4]=d=>$(p)?p.value=!1:p=!1),id:l(_),onSaveDlg:b,roleName:l(s)},null,8,["showDlg","id","roleName"])):O("",!0)]),_:1})],64)}}});export{he as default};
