import{J as R,d as j,c as L,r as _,G as O,K as H,e as s,o as V,s as z,w as o,g as F,h as e,i as l,L as S,k as h,M as I,_ as Q,f as W,F as X,q as te,t as ne,N as se,A as re,C as B,n as K}from"./index-5e8add3e.js";const de=(t,v,c)=>R.get(`/admin/acl/user/${t}/${v}?username=${c}`),ie=t=>R.delete("/admin/acl/user/remove/"+t),ue=t=>t.id?R.put("/admin/acl/user/update",t):R.post("/admin/acl/user/save",t),ce=t=>R.get("/admin/acl/user/get/"+t),me=t=>R.post("/admin/acl/user/doAssignRole",t),pe=t=>R.get("/admin/acl/user/toAssign/"+t),fe={class:"dialog-footer"},_e=j({__name:"addUser",props:{showDlg:{type:Boolean,default:!1},id:Number},emits:"closeDlg",setup(t,{emit:v}){const c=t;let n=L({name:"",username:"",password:"",id:0});const p=_(),r=L({username:[{required:!0,message:"请输入用户名称(至少5位)",trigger:"blur",min:5}],name:[{required:!0,message:"请输入用户昵称(至少5位)",trigger:"blur",min:5}],password:[{required:!0,message:"请输入用户密码(至少6位)",trigger:"blur",min:6}]});O(()=>{c.id&&ce(c.id).then(m=>{console.log("res: ",m),m.code==200&&(Object.assign(n,m.data),console.log("formData: ",n))})});const U=H(()=>c.id?"修改":"新增"),k=()=>{v("closeDlg",!1)},b=async m=>{m&&await m.validate(async(d,C)=>{if(d){const i=await ue(n);console.log(i),i.code==200?I.success(n.id?"修改成功":"新增成功"):I.warning("新增失败"),v("saveDlg",!1)}else console.log("error submit!",C)})};return(m,d)=>{const C=s("el-input"),i=s("el-form-item"),q=s("el-form"),f=s("el-dialog");return V(),z(f,{modelValue:t.showDlg,title:l(U),width:"500px","before-close":k},{footer:o(()=>[F("div",fe,[e(l(S),{onClick:k},{default:o(()=>[h("取消")]),_:1}),e(l(S),{type:"primary",onClick:d[3]||(d[3]=a=>b(p.value))},{default:o(()=>[h("确定")]),_:1})])]),default:o(()=>[F("div",null,[e(q,{model:l(n),"label-width":"100px",ref_key:"formRef",ref:p,rules:r,inline:""},{default:o(()=>[e(i,{label:"用户名称",prop:"username"},{default:o(()=>[e(C,{clearable:"",modelValue:l(n).username,"onUpdate:modelValue":d[0]||(d[0]=a=>l(n).username=a),placeholder:"请输入用户名称"},null,8,["modelValue"])]),_:1}),e(i,{label:"用户昵称",prop:"name"},{default:o(()=>[e(C,{clearable:"",modelValue:l(n).name,"onUpdate:modelValue":d[1]||(d[1]=a=>l(n).name=a),placeholder:"请输入用户昵称"},null,8,["modelValue"])]),_:1}),e(i,{label:"用户密码",prop:"password"},{default:o(()=>[e(C,{clearable:"",disabled:l(n).id,modelValue:l(n).password,"onUpdate:modelValue":d[2]||(d[2]=a=>l(n).password=a),placeholder:"请输入用户密码"},null,8,["disabled","modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"])}}});const ge=Q(_e,[["__scopeId","data-v-436fe474"]]),ve={class:"dialog-footer"},be=j({__name:"addRole",props:{showDlg:{type:Boolean,default:!1},id:Number,userName:String},emits:"closeDlg",setup(t,{emit:v}){const c=t,n=_([]),p=_(!1);let r=L({userId:0,roleIdList:[]});const U=_(!1),k=_(),b=L({}),m=f=>{r.roleIdList=f?n:[]},d=f=>{const a=f.length;U.value=a===n.value.length};O(()=>{c.id&&(r.userId=c.id,pe(c.id).then(f=>{f.code==200&&(n.value=f.data.allRolesList||[],r.roleIdList=f.data.assignRoles.map(a=>a.id))}))});const C=H(()=>c.id?"修改":"新增"),i=()=>{v("closeDlg",!1)},q=async f=>{f&&await f.validate(async(a,A)=>{if(a){const x=await me(r);console.log(x),x.code==200?I.success(c.id?"修改成功":"新增成功"):I.warning("新增失败"),v("saveDlg",!1)}else console.log("error submit!",A)})};return(f,a)=>{const A=s("el-input"),x=s("el-form-item"),$=s("el-checkbox"),E=s("el-checkbox-group"),T=s("el-form"),M=s("el-dialog");return V(),z(M,{modelValue:t.showDlg,title:l(C),width:"500px","before-close":i},{footer:o(()=>[F("div",ve,[e(l(S),{onClick:i},{default:o(()=>[h("取消")]),_:1}),e(l(S),{type:"primary",onClick:a[3]||(a[3]=y=>q(k.value))},{default:o(()=>[h("确定")]),_:1})])]),default:o(()=>[F("div",null,[e(T,{model:l(r),"label-width":"100px",ref_key:"formRef",ref:k,rules:b,inline:""},{default:o(()=>[e(x,{label:"用户名称",prop:""},{default:o(()=>[e(A,{clearable:"",disabled:"",modelValue:l(c).userName,"onUpdate:modelValue":a[0]||(a[0]=y=>l(c).userName=y),placeholder:"请输入用户名称"},null,8,["modelValue"])]),_:1}),e(x,{label:"角色列表",prop:""},{default:o(()=>[e($,{modelValue:l(r).checkAll,"onUpdate:modelValue":a[1]||(a[1]=y=>l(r).checkAll=y),indeterminate:p.value,onChange:m},{default:o(()=>[h(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),e(E,{modelValue:l(r).roleIdList,"onUpdate:modelValue":a[2]||(a[2]=y=>l(r).roleIdList=y),onChange:d},{default:o(()=>[(V(!0),W(X,null,te(n.value,y=>(V(),z($,{key:y.id,label:y.id},{default:o(()=>[h(ne(y.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"])}}});const ye=Q(be,[["__scopeId","data-v-a43e2fc2"]]),he=j({__name:"index",setup(t){let v=L({username:""}),c=_(!1);const n=_();let p=_(1),r=_(5),U=_(0),k=_([]),b=_(!1),m=_(!1),d=_(),C=_();O(()=>{i()});const i=()=>{c.value=!0,de(p.value,r.value,v.username).then(u=>{console.log("res: ",u),u.code==200&&(console.log("res: ",u),k.value=u.data.records||[],U.value=u.data.total||0)}).finally(()=>{c.value=!1})},q=()=>{p.value=1,i()},f=()=>{p.value=1,v.username="",i()},a=u=>{d.value=u.id,C.value=u.username,m.value=!0},A=()=>{b.value=!0,d.value=""},x=u=>{b.value=!0,d.value=u},$=()=>{b.value=!1,p.value=1,i()},E=()=>{m.value=!1,p.value=1,i()},T=u=>{r.value=u,i()},M=u=>{console.log("page: ",u),p.value=u,i()},y=async u=>{(await ie(u)).code==200?(I({type:"success",message:"删除成功"}),i()):I({type:"error",message:"删除失败"})};return(u,D)=>{const Y=s("el-input"),P=s("el-form-item"),N=s("el-button"),Z=s("el-form"),G=s("el-card"),w=s("el-table-column"),ee=s("el-popconfirm"),le=s("el-table"),oe=s("el-pagination"),ae=se("loading");return V(),W(X,null,[e(G,null,{default:o(()=>[e(Z,{model:l(v),"label-width":"100px",ref_key:"searchFormRef",ref:n,inline:""},{default:o(()=>[e(P,{label:"用户名"},{default:o(()=>[e(Y,{clearable:"",placeholder:"用户名",modelValue:l(v).username,"onUpdate:modelValue":D[0]||(D[0]=g=>l(v).username=g)},null,8,["modelValue"])]),_:1}),e(P,null,{default:o(()=>[e(N,{type:"primary",onClick:q},{default:o(()=>[h("搜索")]),_:1}),e(N,{onClick:f},{default:o(()=>[h("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(G,{style:{"margin-top":"14px"}},{default:o(()=>[e(N,{type:"primary",size:"default",icon:"Plus",onClick:A},{default:o(()=>[h(" 新增用户 ")]),_:1}),re((V(),z(le,{style:{margin:"10px 0px"},border:"",data:l(k)},{default:o(()=>[e(w,{label:"序号",width:"80px",align:"center",type:"index"}),e(w,{label:"id",prop:"id",align:"center"}),e(w,{label:"用户名称",prop:"username",align:"center"}),e(w,{label:"用户昵称",prop:"username",align:"center"}),e(w,{label:"用户角色",prop:"username",align:"center"}),e(w,{label:"创建时间",prop:"createTime",align:"center"}),e(w,{label:"更新时间",prop:"updateTime",align:"center"}),e(w,{width:"240",label:"操作",align:"center"},{default:o(({row:g})=>[e(N,{type:"primary",size:"small",icon:"Edit",onClick:J=>a(g)},{default:o(()=>[h(" 分配角色 ")]),_:2},1032,["onClick"]),e(N,{type:"primary",size:"small",icon:"Edit",onClick:J=>x(g.id)},{default:o(()=>[h(" 编辑 ")]),_:2},1032,["onClick"]),e(ee,{title:`您确定要删除${g.tmName}?`,width:"250px",icon:"Delete",onConfirm:J=>y(g.id)},{reference:o(()=>[e(N,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[ae,l(c)]]),e(oe,{onSizeChange:T,onCurrentChange:M,"pager-count":9,"current-page":l(p),"onUpdate:currentPage":D[1]||(D[1]=g=>B(p)?p.value=g:p=g),"page-size":l(r),"onUpdate:pageSize":D[2]||(D[2]=g=>B(r)?r.value=g:r=g),"page-sizes":[5,10,15,20],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:l(U)},null,8,["current-page","page-size","total"]),l(b)?(V(),z(ge,{key:0,showDlg:l(b),id:l(d),onCloseDlg:D[3]||(D[3]=g=>B(b)?b.value=!1:b=!1),onSaveDlg:$},null,8,["showDlg","id"])):K("",!0),l(m)?(V(),z(ye,{key:1,showDlg:l(m),id:l(d),onCloseDlg:D[4]||(D[4]=g=>B(m)?m.value=!1:m=!1),onSaveDlg:E,userName:l(C)},null,8,["showDlg","id","userName"])):K("",!0)]),_:1})],64)}}});export{he as default};
