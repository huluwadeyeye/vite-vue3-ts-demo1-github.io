import{r as Y,u as Z,a as ee,b as te}from"./category-08617b02.js";import{d as j,c as H,r as m,K as le,e as r,o as i,s as g,w as t,g as G,h as e,i as l,L as F,k as N,M as w,_ as ae,G as oe,N as ne,f as C,F as D,q as S,A as re,t as se,n as ce}from"./index-5e8add3e.js";const de={class:"dialog-footer"},ie=j({__name:"attrAdd",props:{showDlg:{type:Boolean,default:!1},id:String,categoryId:String},emits:"closeDlg",setup(U,{emit:s}){const f=U;let c=H({attrName:"",attrValueList:[],categoryId:f.categoryId,categoryLevel:0,createTime:"",id:"",updateTime:""});const L=m(),k=H({attrName:[{required:!0,message:"请输入属性名称",trigger:"blur"}]}),x=a=>{console.log("index: ",a),c.attrValueList.splice(a,1)},y=le(()=>f.id?"修改":"新增"),b=()=>{s("closeDlg",!1)},E=()=>{c.attrValueList.push({valueName:""})},A=async a=>{a&&await a.validate(async(u,v)=>{if(u){if(c.attrValueList.length<=0){w.warning("请新增属性值");return}let V={};for(let _=0;_<c.attrValueList.length;_++){let I=c.attrValueList[_].valueName;if(V[I]){w.warning("属性值不可重复");return}}const p=await Y(c);console.log(p),p.code==200?w.success(c.id?"修改成功":"新增成功"):w.warning("新增失败"),b()}else console.log("error submit!",v)})};return(a,u)=>{const v=r("el-input"),V=r("el-form-item"),p=r("el-table-column"),_=r("el-popconfirm"),I=r("el-table"),$=r("el-form"),q=r("el-dialog");return i(),g(q,{modelValue:U.showDlg,title:l(y),width:"700px","before-close":b},{footer:t(()=>[G("div",de,[e(l(F),{onClick:b},{default:t(()=>[N("取消")]),_:1}),e(l(F),{type:"primary",onClick:u[2]||(u[2]=n=>A(L.value))},{default:t(()=>[N("确定")]),_:1})])]),default:t(()=>[G("div",null,[e($,{model:l(c),"label-width":"100px",ref_key:"formRef",ref:L,rules:k,inline:""},{default:t(()=>[e(V,{label:"属性名称",prop:"attrName"},{default:t(()=>[e(v,{clearable:"",modelValue:l(c).attrName,"onUpdate:modelValue":u[0]||(u[0]=n=>l(c).attrName=n),placeholder:"请输入属性名称"},null,8,["modelValue"])]),_:1}),G("div",null,[e(l(F),{type:"primary",onClick:E},{default:t(()=>[N("新增属性值")]),_:1})]),e(I,{border:"",data:l(c).attrValueList,style:{width:"100%","margin-top":"14px"}},{default:t(()=>[e(p,{label:"序号",type:"index",width:"70"}),e(p,{prop:"valueName",label:"属性值"},{default:t(({row:n,$index:d})=>[e(V,{label:"","label-width":"0",prop:`attrValueList.${d}.valueName`,rules:{required:!0,message:"请输入属性值",trigger:"blur"}},{default:t(()=>[e(v,{style:{width:"100%"},modelValue:l(c).attrValueList[d].valueName,"onUpdate:modelValue":h=>l(c).attrValueList[d].valueName=h,placeholder:"请输入属性值"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:1}),e(p,{label:"操作",align:"center",width:"150"},{default:t(({row:n})=>[e(_,{title:`您确定要删除${n.valueName}?`,width:"250px",icon:"Delete",onConfirm:u[1]||(u[1]=d=>x(a.$index))},{reference:t(()=>[e(l(F),{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"])}}});const ue=ae(ie,[["__scopeId","data-v-ed90c7de"]]),_e=j({__name:"index",setup(U){let s=H({category1Id:"",category2Id:"",category3Id:""}),f=m(!1);const c=m();let L=m([]),k=m([]),x=m([]),y=m(!1),b=m(""),E=m(),A=m([]);const a=Z();oe(()=>{I()});const u=()=>{f.value=!0,te(s.category1Id,s.category2Id,s.category3Id).then(n=>{console.log("res: ",n),n.code==200&&(console.log("res: ",n),A.value=n.data)}).finally(()=>{f.value=!1})},v=()=>{y.value=!1,u()},V=()=>{b.value="",y.value=!0},p=()=>{},_=async n=>{(await ee(n)).code==200?(w({type:"success",message:"删除成功"}),u()):w({type:"error",message:"删除失败"})},I=async()=>{await a.getC1(),L.value=a.c1List,s.category1Id=a.c1List[1].id,a.c1Id=a.c1List[1].id,$()},$=async n=>{await a.getC2(),k.value=a.c2List,console.log("useCategoryStore.c2List: ",a.c2List),console.log(a.c2List),s.category2Id=n||a.c2List[0].id,a.c2Id=n||a.c2List[0].id,console.log(1234),q()},q=async n=>{await a.getC3(),x.value=a.c3List,s.category3Id=n||a.c3List[0].id,a.c3Id=n||a.c3List[0].id};return(n,d)=>{const h=r("el-option"),z=r("el-select"),R=r("el-form-item"),J=r("el-form"),K=r("el-card"),T=r("el-button"),B=r("el-table-column"),O=r("el-tag"),Q=r("el-popconfirm"),W=r("el-table"),X=ne("loading");return i(),C(D,null,[e(K,null,{default:t(()=>[e(J,{model:l(s),"label-width":"100px",ref_key:"searchFormRef",ref:c,inline:""},{default:t(()=>[e(R,{label:"一级分类"},{default:t(()=>[e(z,{modelValue:l(s).category1Id,"onUpdate:modelValue":d[0]||(d[0]=o=>l(s).category1Id=o),placeholder:"一级分类",clearable:"",onChange:$},{default:t(()=>[(i(!0),C(D,null,S(l(L),o=>(i(),g(h,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(R,{label:"二级分类"},{default:t(()=>[e(z,{modelValue:l(s).category2Id,"onUpdate:modelValue":d[1]||(d[1]=o=>l(s).category2Id=o),placeholder:"二级分类",clearable:"",onChange:q},{default:t(()=>[(i(!0),C(D,null,S(l(k),o=>(i(),g(h,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(R,{label:"三级分类"},{default:t(()=>[e(z,{modelValue:l(s).category3Id,"onUpdate:modelValue":d[2]||(d[2]=o=>l(s).category3Id=o),placeholder:"三级分类",clearable:""},{default:t(()=>[(i(!0),C(D,null,S(l(x),o=>(i(),g(h,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),e(K,{style:{"margin-top":"14px"}},{default:t(()=>[e(T,{type:"primary",size:"default",icon:"Plus",onClick:V},{default:t(()=>[N(" 新增属性 ")]),_:1}),re((i(),g(W,{style:{margin:"10px 0px"},border:"",data:l(A)},{default:t(()=>[e(B,{label:"序号",width:"80px",align:"center",type:"index"}),e(B,{label:"属性名称",prop:"attrName",align:"center"}),e(B,{label:"属性值名称",prop:"",align:"center"},{default:t(({row:o,$index:M})=>[(i(!0),C(D,null,S(o.attrValueList,P=>(i(),g(O,{type:M/2==0?"success":"",key:P.id},{default:t(()=>[N(se(P.valueName),1)]),_:2},1032,["type"]))),128))]),_:1}),e(B,{label:"操作",align:"center"},{default:t(({row:o})=>[e(T,{type:"primary",size:"small",icon:"Edit",onClick:M=>p(o)},null,8,["onClick"]),e(Q,{title:`您确定要删除${o.tmName}?`,width:"250px",icon:"Delete",onConfirm:M=>_(o.id)},{reference:t(()=>[e(T,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[X,l(f)]]),l(y)?(i(),g(ue,{key:0,onCloseDlg:v,ref_key:"attrDlg",ref:E,categoryId:n.category1Id,showDlg:l(y),rowId:l(b)},null,8,["categoryId","showDlg","rowId"])):ce("",!0)]),_:1})],64)}}});export{_e as default};
