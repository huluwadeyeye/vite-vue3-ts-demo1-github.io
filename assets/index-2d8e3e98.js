import{J,d as K,c as T,r as p,K as Y,e as o,o as c,s as V,w as l,g as G,h as e,i as t,L as I,k as B,f as g,F as w,q as D,_ as Z,G as ee,N as le,A as te,n as ae,M as H}from"./index-5e8add3e.js";import{u as oe}from"./category-08617b02.js";const ne=(y,i)=>J.get(`/admin/product/${y}/${i}`),re=y=>J.delete("/admin/product/deleteSpu"+y),se=["src"],de={class:"dialog-footer"},ue=K({__name:"spuAddDlg",props:{showDlg:{type:Boolean,default:!1},id:String},emits:"closeDlg",setup(y,{emit:i}){const h=y,P=[{value:"Option1",label:"Option1"}];let s=T({name:"",imgList:[],attrValueList:[]});const C=p(),N=T({name:[{required:!0,message:"请输入SPU名称",trigger:"blur"}]}),F=m=>{},k=Y(()=>h.id?"修改":"新增"),U=()=>{i("closeDlg",!1)},R=async m=>{m&&await m.validate(async(r,d)=>{})};return(m,r)=>{const d=o("el-input"),f=o("el-form-item"),$=o("el-option"),A=o("el-selct"),E=o("Plus"),z=o("el-icon"),M=o("el-upload"),b=o("el-table-column"),u=o("el-popconfirm"),_=o("el-table"),x=o("el-row"),L=o("el-form"),S=o("el-dialog");return c(),V(S,{modelValue:y.showDlg,title:t(k),width:"700px","before-close":U},{footer:l(()=>[G("div",de,[e(t(I),{onClick:U},{default:l(()=>[B("取消")]),_:1}),e(t(I),{type:"primary",onClick:r[5]||(r[5]=a=>R(C.value))},{default:l(()=>[B("确定")]),_:1})])]),default:l(()=>[G("div",null,[e(L,{model:t(s),"label-width":"100px",ref_key:"formRef",ref:C,rules:N,inline:""},{default:l(()=>[e(f,{label:"SPU名称",prop:""},{default:l(()=>[e(d,{clearable:"",modelValue:t(s).name,"onUpdate:modelValue":r[0]||(r[0]=a=>t(s).name=a),placeholder:"请输入SPU名称"},null,8,["modelValue"])]),_:1}),e(f,{label:"SPU品牌",prop:""},{default:l(()=>[e(A,{clearable:"",filterable:"",modelValue:t(s).name,"onUpdate:modelValue":r[1]||(r[1]=a=>t(s).name=a),placeholder:"请选择SPU品牌"},{default:l(()=>[(c(),g(w,null,D(P,a=>e($,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"SPU描述",prop:""},{default:l(()=>[e(d,{type:"textarea",rows:3,modelValue:t(s).name,"onUpdate:modelValue":r[2]||(r[2]=a=>t(s).name=a),placeholder:"请输入SPU描述"},null,8,["modelValue"])]),_:1}),e(f,{label:"SPU照片",prop:""},{default:l(()=>[e(M,{class:"avatar-uploader",action:"/api/admin/product/fileUpload","show-file-list":!1,"on-success":m.handleAvatarSuccess,"before-upload":m.beforeAvatarUpload},{default:l(()=>[t(s).imgList&&t(s).imgList.length>0?(c(!0),g(w,{key:0},D(t(s).imgList,(a,v)=>(c(),g("img",{key:v,src:a==null?void 0:a.url,class:"avatar"},null,8,se))),128)):(c(),V(z,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[e(E)]),_:1}))]),_:1},8,["on-success","before-upload"])]),_:1}),e(f,{label:"SPU销售属性",prop:""},{default:l(()=>[e(A,{clearable:"",filterable:"",modelValue:t(s).name,"onUpdate:modelValue":r[3]||(r[3]=a=>t(s).name=a),placeholder:"请选择SPU销售属性"},{default:l(()=>[(c(),g(w,null,D(P,a=>e($,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(t(I),{type:"primary",icon:"el-icon-plus"},{default:l(()=>[B("新增销售属性")]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(_,{border:"",data:t(s).attrValueList,style:{width:"100%","margin-top":"14px"}},{default:l(()=>[e(b,{label:"序号",type:"index",width:"70"}),e(b,{label:"属性名",type:"valueName",width:"180"}),e(b,{prop:"valueName",label:"属性值"},{default:l(({row:a,$index:v})=>[e(f,{label:"","label-width":"0",prop:`attrValueList.${v}.valueName`,rules:{required:!0,message:"请输入属性值",trigger:"blur"}},{default:l(()=>[e(t(I),{type:"success",icon:"el-icon-plus"})]),_:2},1032,["prop"])]),_:1}),e(b,{label:"操作",align:"center",width:"150"},{default:l(({row:a})=>[e(u,{title:`您确定要删除${a.valueName}?`,width:"250px",icon:"Delete",onConfirm:r[4]||(r[4]=v=>F(m.$index))},{reference:l(()=>[e(t(I),{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","title"])}}});const ce=Z(ue,[["__scopeId","data-v-f76d52f9"]]),me=K({__name:"index",setup(y){let i=T({category1Id:"",category2Id:"",category3Id:""}),h=p(!1);const P=p();let s=p([]),C=p([]),N=p([]),F=p(),k=p(!1),U=p(""),R=p(1),m=p(3);p(0);let r=p([]);const d=oe();ee(()=>{});const f=()=>{h.value=!0,ne(R,m).then(u=>{console.log("res: ",u),u.code==200&&(console.log("res: ",u),r.value=u.data||[])}).finally(()=>{h.value=!1})},$=()=>{},A=()=>{U.value="",k.value=!0},E=()=>{},z=async u=>{(await re(u)).code==200?(H({type:"success",message:"删除成功"}),f()):H({type:"error",message:"删除失败"})},M=async u=>{await d.getC2(),C.value=d.c2List||[],console.log("useCategoryStore.c2List: ",d.c2List),i.category2Id=u||d.c2List[0].id,d.c2Id=u||d.c2List[0].id,b()},b=async u=>{await d.getC3(),N.value=d.c3List||[],i.category3Id=u||d.c3List[0].id,d.c3Id=u||d.c3List[0].id};return(u,_)=>{const x=o("el-option"),L=o("el-select"),S=o("el-form-item"),a=o("el-form"),v=o("el-card"),O=o("el-button"),q=o("el-table-column"),j=o("el-popconfirm"),Q=o("el-table"),W=le("loading");return c(),g(w,null,[e(v,null,{default:l(()=>[e(a,{model:t(i),"label-width":"100px",ref_key:"searchFormRef",ref:P,inline:""},{default:l(()=>[e(S,{label:"一级分类"},{default:l(()=>[e(L,{modelValue:t(i).category1Id,"onUpdate:modelValue":_[0]||(_[0]=n=>t(i).category1Id=n),placeholder:"一级分类",clearable:"",onChange:M},{default:l(()=>[(c(!0),g(w,null,D(t(s),n=>(c(),V(x,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(S,{label:"二级分类"},{default:l(()=>[e(L,{modelValue:t(i).category2Id,"onUpdate:modelValue":_[1]||(_[1]=n=>t(i).category2Id=n),placeholder:"二级分类",clearable:"",onChange:b},{default:l(()=>[(c(!0),g(w,null,D(t(C),n=>(c(),V(x,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(S,{label:"三级分类"},{default:l(()=>[e(L,{modelValue:t(i).category3Id,"onUpdate:modelValue":_[2]||(_[2]=n=>t(i).category3Id=n),placeholder:"三级分类",clearable:""},{default:l(()=>[(c(!0),g(w,null,D(t(N),n=>(c(),V(x,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),e(v,{style:{"margin-top":"14px"}},{default:l(()=>[e(O,{type:"primary",size:"default",icon:"Plus",onClick:A},{default:l(()=>[B(" 新增spu ")]),_:1}),te((c(),V(Q,{style:{margin:"10px 0px"},border:"",data:t(r)},{default:l(()=>[e(q,{label:"序号",width:"80px",align:"center",type:"index"}),e(q,{label:"SPU名称",prop:"attrName",align:"center"}),e(q,{label:"SPU描述",prop:"attrName",align:"center"}),e(q,{label:"操作",align:"center"},{default:l(({row:n})=>[e(O,{type:"primary",size:"small",icon:"Edit",onClick:X=>E(n)},null,8,["onClick"]),e(j,{title:`您确定要删除${n.tmName}?`,width:"250px",icon:"Delete",onConfirm:X=>z(n.id)},{reference:l(()=>[e(O,{type:"primary",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[W,t(h)]]),t(k)?(c(),V(ce,{key:0,ref_key:"spuAddDlgRef",ref:F,onCloseDlg:$,showDlg:t(k),id:t(U)},null,8,["showDlg","id"])):ae("",!0)]),_:1})],64)}}});export{me as default};
